class WMPlaylistItem{#t=!1;#e=null;#i=null;#s=null;#n=[];#r=[];constructor(t){if(t+""===t){let e=t;switch(t={src:t},function(){let t;try{t=new URL(e,window.location.href)}catch(t){return}let i=t.pathname,s=i.search(/[\.\/\\][^\.\/\\]*$/);if(!(s<0||"."!=i[s]))return i.substring(s+1)}()){case"aac":case"aiff":case"flac":case"m4a":case"mp3":case"ogg":case"opus":case"wav":case"wma":t.audio_only=!0}}if(this.#t=t?.audio_only||!1,this.#e=null,"mediaSession"in navigator){let e=t?.metadata;try{e&&(e instanceof MediaMetadata||(e=new MediaMetadata(e)),this.#e=e)}catch(t){console.warn(t)}}this.#i=t?.poster||null,this.#s=t?.src||null,this.#h(t?.tracks,t?.sources)}get audio_only(){return this.#t}get empty(){if(this.#s)return!1;if(0==this.#n.length)return!0;for(let t of this.#n)if(t.src||t.srcset)return!1;return!0}get metadata(){return this.#e}populateMediaElement(t){t.poster=this.#i||"",t.src=this.#s||"",t.replaceChildren(...this.#n.concat(this.#r)),t.currentTime=0}#h(t,e){if(e){let t=e,i=t.length;for(let e=0;e<i;++e){let i=t[e];if(i instanceof HTMLSourceElement){this.#n.push(i);continue}let s=document.createElement("source");for(let t of["height","media","sizes","src","srcset","type","width"]){let e=i[t];e&&(s[t]=e)}this.#n.push(s)}}if(t){let e=t,i=e.length;for(let t=0;t<i;++t){let i=e[t];if(i instanceof HTMLTrackElement){this.#r.push(i);continue}let s=document.createElement("track");for(let t of["kind","label","src","srclang"]){let e=i[t];e&&(s[t]=e)}!i.src&&i.vttText&&(s.src=`data:text/vtt;charset=UTF-8,${encodeURIComponent(i.vttText)}`),i.default&&s.setAttribute("default","default"),this.#r.push(s)}}}}class WMPlaylist extends EventTarget{#l=[];#a=0;#o=!1;#c=!1;#f=[];#d=!1;constructor(){super()}empty(){return 0==this.#l.length}get currentItem(){return this.#l[this.#a]||null}get index(){return this.#a}set index(t){if((t=+t)<0||t>=this.#l.length){if(!this.#o||!this.#l.length)return;t=t<0?this.#l.length-1:0}this.#a=t,this.#d=!1,this.#u()}get loop(){return this.#o}set loop(t){t=!!t,this.#o!=t&&(this.#o=t,this.dispatchEvent(new CustomEvent("loop-flag-changed",{detail:t})))}get shuffle(){return this.#c}set shuffle(t){t=!!t,this.#c!=t&&(this.#c=t,this.dispatchEvent(new CustomEvent("shuffle-flag-changed",{detail:t})))}get length(){return this.#l.length}get size(){return this.#l.length}#u(){let t=this.#a,e=null;0==this.#l.length?t=null:e=this.#l[t],this.dispatchEvent(new CustomEvent("current-item-changed",{detail:{index:t,item:e}}))}add(t){(t instanceof WMPlaylistItem||!(t=new WMPlaylistItem(t)).empty)&&(this.#l.push(t),this.#f.push(this.#l.length-1),this.dispatchEvent(new Event("modified")),1==this.#l.length&&(this.index=0))}clear(){this.#l=[],this.#a=0,this.#f=[],this.#d=0,this.dispatchEvent(new Event("cleared")),this.#u()}indexOf(t){return this.#l.indexOf(t)}insertAt(t,e){t<0?t=0:t>=this.#l.length&&(t=this.#l.length),this.#l.splice(t,0,e);let i=this.#f,s=i.length;for(let e=0;e<s;++e)i[e]>=t&&++i[e];i.push(t)}item(t){return this.#l[t]}moveItemTo(t,e){let i;if(t instanceof WMPlaylistItem){if(i=this.indexOf(t),i<0)return}else{if(i=+t,isNaN(i)||i!=Math.floor(i))throw new TypeError("must specify a source WMPlaylistItem or integerindex");if(i<0||i>=this.#l.length)throw new Error("out-of-bounds source index")}if(e=+e,isNaN(e)||e!=Math.floor(e))throw new TypeError("must specify an integer destination index");if(e<0)throw new Error("out-of-bounds destination index");if(e>this.#l.length)return;if(e==i)return;let s=this.#l[i];this.#l.splice(i,1),e>i&&--e,this.#l.splice(e,0,s);let n=this.#f;n.length;for(let t=0;t<n;++t)n[t]==i?n[t]=e:n[t]>i&&n[t]<=e?--n[t]:n[t]>e&&n[t]<i&&++n[t];this.#a==i&&(this.#a=e),this.dispatchEvent(new Event("modified"))}remove(t,e){if(void 0===e)e=1;else{if(0==e)return;if(e<0)throw new Error("cannot remove a negative amount of items")}let i;if(t instanceof WMPlaylistItem){if(this.indexOf(t)<0)return}else{if(i=+t,isNaN(i))throw new TypeError("must specify a WMPlaylistItem or an index");if(i<0&&(e+=i,i=0,e<0))return}if(this.#l.splice(i,e),1==e){let t=this.#f.indexOf(i);t>=0&&this.#f.splice(t,1)}else{let t=[];for(let s of this.#f)s>=i&&s<i+e||(s>=i+e&&(s-=e),t.push(s));this.#f=t}let s=!1;this.#a>=i&&this.#a<i+e&&(this.#a=i,this.#d=!1,s=!0),this.dispatchEvent(new Event("modified")),s&&this.#u()}toArray(){return[].concat(this.#l)}markAsPlayed(){if(this.#d)return;this.#d=!0;let t=this.#f,e=t.indexOf(this.#a);e>=0&&t.splice(e,1)}hasNextItem(t){return!!this.#o||(t||!this.#c?this.#a<this.#l.length-1:this.#f.length>0)}toNext(t){let e=this.#a+1;if(this.#c&&!t){if(1==this.#l.length)return;let t,i=this.#f;if(i.length>1||this.#d&&i.length>0)do{t=Math.floor(Math.random()*i.length),e=i[t]}while(e==this.#a);else{if(!this.#o)return;t=Math.floor(Math.random()*this.#l.length),e=t,this.#f=Object.keys(this.#l),this.#f.splice(t,1)}}let i=this.#a;return this.index=e,this.#a!=i}toPrev(){let t=this.#a;return this.index=this.#a-1,this.#a!=t}replace(t){0!=t.length?(this.#l=Array.from(t),this.#a=0,this.#f=Object.keys(this.#l),this.#d=!1,this.dispatchEvent(new Event("replaced")),this.#u()):this.clear()}}